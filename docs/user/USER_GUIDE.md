# 時間表系統使用指南
*Timesheet Application User Guide*

## 🎯 系統概述

本時間表系統是一個基於網頁的工時管理工具，支援多週工時表管理、自動資料驗證、CSV 資料整合等功能。系統設計為單人使用，所有資料儲存在瀏覽器本地。

### 版本資訊
- **當前版本**: v3.2.6
- **更新日期**: 2025-07-01
- **主要特色**: Admin/Training驗證、統一日期格式、TPM驗證工具、匯出匯入功能

## ✨ 主要功能特色

### 1. 多週工時表管理
- **卡片化展示**：以視覺化卡片顯示各週工時表
- **快速統計**：顯示每週總工時和記錄筆數
- **狀態指示**：
  - ✓ 綠色：總工時達 40 小時
  - ⚠ 橙色：總工時未達 40 小時
- **完整操作**：支援建立、編輯、刪除、複製、匯出、匯入

### 2. 智慧型資料管理
- **全域基本資料管理**：員工姓名和內部/外包類型只需設定一次，全域共用
- **Zone 聯動選擇機制**：選擇區域後自動篩選對應的專案和產品模組
- **PM 自動填充**：根據 Zone + Project 組合自動填充專案經理
- **CSV 資料整合**：自動載入專案、產品模組、活動類型等參考資料

### 3. 資料驗證系統
- **即時驗證**：表單填寫過程中即時檢查資料正確性
- **規則驗證**：
  - 正常工時不能超過8小時
  - Admin/Training活動自動設定對應Zone/Project
  - 日期範圍必須在週次範圍內
- **TPM驗證工具**：獨立的驗證儀表板，支援批次檢查

### 4. CSV匯出匯入功能
- **UTF-8編碼匯出**：支援中文檔名和內容
- **正規化模式**：週總工時 > 40 小時時可選擇調整
- **衝突處理機制**：
  - 一致資料：確認對話框（繼續匯入/取消匯入）
  - 衝突資料：選擇對話框（使用本地資料/使用CSV資料）
- **自動分組**：匯入時自動按週次分組

## 📱 快速開始指南

### 第一次使用

#### 1. 設定基本資料
1. 開啟系統首頁 (`index.html`)
2. 點擊「基本資料設定」按鈕
3. 填寫員工姓名和選擇內部/外包類型
4. 點擊「儲存」完成設定

#### 2. 建立第一個工時表
1. 點擊「新建」按鈕
2. 輸入週次格式（例如：2024-W25）
3. 系統自動跳轉到編輯頁面

### 日常使用流程

#### 1. 填寫工時記錄
1. **選擇區域（Zone）**
   - Customer Portal：客戶入口網站相關工作
   - ERP：企業資源計劃系統
   - OA：辦公自動化系統
   - Admin：行政管理和培訓

2. **選擇專案**
   - 系統自動載入該區域的所有專案
   - 顯示格式：「專案名稱 (專案代碼)」
   - PM欄位自動填入對應專案經理

3. **選擇產品模組**
   - 系統自動載入該區域的產品模組清單

4. **選擇活動類型**
   - UI/UX Design：使用者介面和體驗設計
   - Architecture Planning：架構規劃
   - System Design：系統設計
   - Coding：程式開發
   - Testing / QA：測試和品質保證
   - Deployment / Monitoring：部署和監控
   - Troubleshooting：問題排除
   - Requirement Analysis：需求分析
   - **Admin / Training**：行政和培訓（特殊規則）
   - Leave：請假

5. **填寫工時資訊**
   - **正常工時**：0-8小時（必填，有上限驗證）
   - **加班工時**：不限制（選填）
   - **總工時**：自動計算
   - **工作日期**：必須在週次範圍內

6. **添加任務描述和備註**

#### 2. 儲存和管理記錄
1. 點擊「儲存記錄」完成單筆記錄
2. 可在記錄列表中編輯或刪除
3. 使用「新增記錄」按鈕繼續添加
4. 「匯出本週」導出CSV檔案

## 🔧 特殊功能說明

### Admin / Training 活動規則

當選擇「Admin / Training」活動類型時：

#### 自動設定
- **Zone**：自動設為「Admin」
- **Project**：自動設為「Admin」
- **Product Module**：自動設為「Non Product Non Product」

#### 限制規則
- 選擇Admin/Training後，Zone無法改為其他選項
- 如需變更Zone，必須先改變活動類型

#### 修改步驟
1. 先將活動類型改為其他選項
2. 然後可以自由變更Zone
3. 再選擇對應的Project和Product Module

### 正常工時限制

#### 驗證機制
- **即時驗證**：輸入時檢查是否超過8小時
- **自動修正**：超過8小時時自動重設為8並提示
- **儲存防護**：儲存前再次檢查，防止無效資料

#### 加班工時
- 無上限限制
- 總工時 = 正常工時（最多8） + 加班工時

### CSV匯出正規化

當週正常工時總計超過40小時時：

#### 選擇機制
系統提示：「此週正常工時總計 X 小時，超過40小時。是否要進行正規化處理？」

- **確定**：將正常工時調整為40小時，超出部分轉為加班工時
- **取消**：按原始工時匯出

#### 應用場景
- 合規性報告需要
- 薪資計算系統整合
- 工時統計標準化

## 🛠️ TPM驗證工具

### 存取方式
開啟 `tpm-validator.html` 進入獨立驗證儀表板

### 驗證規則
1. **Admin/Training規則**：確保活動類型與Zone/Project/Product的一致性
2. **8小時正常工時規則**：檢查每筆記錄是否超過8小時上限
3. **週總工時檢查**：驗證週總工時是否在合理範圍

### 使用流程
1. 上傳CSV檔案進行批次驗證
2. 檢視詳細驗證結果
3. 匯出符合規範的資料
4. 處理重複記錄和衝突

### 🔗 檔案合併工具

TPM驗證工具現在支援合併兩個已匯出的TPM檔案：

#### 使用場景
- 合併不同時期的TPM匯出檔案
- 整合來自不同來源的工時資料
- 建立最終的完整工時報告

#### 操作步驟
1. **選擇檔案**：
   - 點擊「選擇檔案 A」載入第一個TPM檔案
   - 點擊「選擇檔案 B」載入第二個TPM檔案
   - 系統會顯示每個檔案的記錄數量

2. **檢視預覽**：
   - 查看合併預覽統計
   - 檢查重複記錄數量
   - 確認最終記錄數量

3. **選擇處理方式**：
   - **跳過重複記錄**：保留檔案A的記錄，跳過檔案B的重複記錄
   - **包含所有記錄**：包含所有記錄，重複記錄會在備註欄標記
   - **手動檢查重複記錄**：出現重複時手動選擇處理方式

4. **執行合併**：
   - 點擊「合併檔案」開始處理
   - 系統自動產生時間戳檔名：`TPM_Combined_[timestamp].csv`
   - 下載合併後的檔案

#### 重複記錄檢測
系統使用以下欄位組合檢測重複記錄：
- 員工姓名 + 區域 + 專案 + 任務 + 日期 + 正常工時 + 加班工時

#### 功能特色
- **智能檢測**：自動識別重複記錄
- **彈性處理**：三種處理模式滿足不同需求
- **安全合併**：保持資料完整性
- **詳細回饋**：提供完整的合併統計資訊

## 📊 資料格式說明

### 支援的CSV格式

#### 匯出格式
```csv
員工姓名,內部/外包,任務,區域,專案,產品模組,活動類型,正常工時,加班工時,總工時,日期,開始日期,結束日期,備註,專案經理
```

#### 匯入要求
- UTF-8編碼
- 逗號分隔
- 引號包圍含逗號的欄位
- 日期格式：YYYY-MM-DD

### 週次格式
- 標準格式：`YYYY-Www`（例如：2024-W25）
- 週日為週首日
- 自動計算週次範圍

## 🔍 常見問題解答

### 操作問題

**Q: 選擇Admin/Training後無法變更Zone？**
A: 這是設計的驗證規則。請先將活動類型改為其他選項，再變更Zone。

**Q: 專案下拉選單是空的？**
A: 請確認已選擇Zone，且CSV參考檔案載入正常。檢查瀏覽器console是否有錯誤訊息。

**Q: PM欄位沒有自動填入？**
A: PM查詢需要Zone和Project都選擇完成。如果Zone發生變更，PM欄位會自動清空。

### 資料問題

**Q: 匯入時出現基本資料衝突對話框？**
A: 這是正常現象。選擇「使用本地資料」保留現有設定，或「使用CSV資料」採用匯入的資訊。

**Q: 工時記錄消失了？**
A: 資料儲存在瀏覽器本地。清除瀏覽器資料或更換瀏覽器會導致資料遺失。建議定期匯出備份。

**Q: CSV匯出檔案亂碼？**
A: 系統使用UTF-8編碼。請確認用支援UTF-8的應用程式開啟，如Excel需要正確的匯入設定。

### 技術問題

**Q: 連續匯出時檔案選擇器異常？**
A: v3.3.0已修復此問題。如仍有問題，請嘗試重新整理頁面。

**Q: TPM驗證失敗？**
A: 檢查是否違反Admin/Training規則或8小時工時限制。詳細錯誤訊息會顯示在驗證報告中。

## 💡 使用技巧

### 效率提升
1. **一次性設定基本資料**：避免重複輸入員工資訊
2. **先選Zone再選Project**：確保PM自動填充正常運作
3. **使用複製功能**：複製類似週次快速建立新記錄
4. **定期匯出備份**：防止瀏覽器資料意外遺失

### 資料管理
1. **週次命名規範**：統一使用YYYY-Www格式
2. **任務描述詳細**：有助於日後查詢和分析
3. **合理分配工時**：注意8小時正常工時上限
4. **及時處理驗證錯誤**：使用TPM工具定期檢查

### 系統維護
1. **瀏覽器相容性**：建議使用Chrome、Firefox、Safari最新版本
2. **定期清理**：刪除不需要的測試記錄
3. **資料備份**：重要資料務必匯出保存
4. **更新追蹤**：關注系統版本更新

## 🚀 系統限制與建議

### 技術限制
- **本地儲存**：資料僅存於瀏覽器，無雲端同步
- **單人使用**：不支援多人協作
- **檔案大小**：CSV檔案建議小於1MB
- **網路需求**：載入CSV參考檔案需要網路連線

### 使用建議
- **定期備份**：每週匯出重要工時記錄
- **數據驗證**：使用TPM工具確保資料符合規範
- **瀏覽器選擇**：使用現代瀏覽器獲得最佳體驗
- **操作習慣**：按照Zone→Project→Product的順序選擇

---

*本指南涵蓋時間表系統v3.2.6的完整功能。如需技術支援或功能建議，請聯絡系統管理員。*